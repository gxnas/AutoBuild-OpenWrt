name: Build_x86_64_test

on: 
  release:
    types: [published]

  push:
    branches: 
      - master

  schedule:
    - cron: 0 7 * * 6
  
  watch:
    types: [started]

env:
  UPLOAD_NAS: true
  TargetPath: openwrt
  ftp_port: ${{ secrets.FTP_PORT }}
  ftp_username: ${{ secrets.FTP_USERNAME }}
  ftp_psw: ${{ secrets.FTP_PSW }}
  ftp_ip: ${{ secrets.FTP_IP }}
  upload_file_1: crontab_list.sh


jobs:
  build:
    runs-on: Ubuntu-20.04

    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: Upload firmware to GXNAS-DS918
      id: GXNAS-DS918
      run: |
        curl -SLO https://raw.githubusercontent.com/LXK9301/jd_scripts/master/docker/crontab_list.sh
        echo $ftp_psw > /tmp/rsync.psw && chmod 600 /tmp/rsync.psw
        rsync -avrzP -e $ftp_port $upload_file_1 $ftp_username@$ftp_ip::$TargetPath --password-file=/tmp/rsync.psw
        echo "All Released Files Uploaded to GXNAS-DS918"
    
    - name: Delete workflow runs
      uses: GitRML/delete-workflow-runs@main
      with:
        retain_days: 30
        keep_minimum_runs: 5
